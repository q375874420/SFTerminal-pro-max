---
import { getLangFromUrl, useTranslations, type Lang } from '../i18n/utils';
import { defaultLanguage } from '../i18n/translations';

interface Props {
  title: string;
  description?: string;
  lang?: Lang;
}

const { title, description, lang } = Astro.props;
const currentLang = lang || getLangFromUrl(Astro.url);
const t = useTranslations(currentLang);
const pageDescription = description || (currentLang === 'zh' ? 'AI 驱动的跨平台终端，助力运维提效' : 'AI-powered cross-platform terminal for DevOps efficiency');
---

<!doctype html>
<html lang={currentLang === 'zh' ? 'zh-CN' : 'en'}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={pageDescription} />
    <meta name="keywords" content={currentLang === 'zh' ? '旗鱼终端, AI终端, SSH客户端, 终端模拟器, 运维工具, AI Agent' : 'SFTerm, AI Terminal, SSH Client, Terminal Emulator, DevOps Tools, AI Agent'} />
    <meta name="author" content="旗鱼" />
    
    <!-- Open Graph -->
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="/logo.png" />
    
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" href="/logo.png" />
    
    <title>{title}</title>
  </head>
  <body>
    <slot />
    
    <script>
      // 滚动动画观察器
      const observerOptions = {
        root: null,
        rootMargin: '0px',
        threshold: 0.1
      };

      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('visible');
          }
        });
      }, observerOptions);

      document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('.fade-in').forEach(el => {
          observer.observe(el);
        });
      });

      // 浏览器语言自动检测
      (function() {
        // 检查是否已经记住用户选择
        const savedLang = localStorage.getItem('preferred-lang');
        if (savedLang) return;

        // 检查当前路径
        const currentPath = window.location.pathname;
        const isEnglishPath = currentPath.startsWith('/en');

        // 检测浏览器语言
        const browserLang = navigator.language || navigator.languages?.[0] || 'en';
        const prefersEnglish = browserLang.startsWith('en') && !browserLang.startsWith('zh');

        // 如果浏览器是英文且当前在中文页，跳转到英文页
        if (prefersEnglish && !isEnglishPath) {
          window.location.href = '/en' + currentPath;
        }
      })();
    </script>
  </body>
</html>

<style is:global>
  @import '../styles/global.css';
</style>

